<!doctype html><html>
<head>
<title>
JSON Changelog with SQLite
</title>
<script defer src=https://stats.budgetwithbuckets.com/flow data-website-id=026e077d-2da2-412a-840f-faadf974afbc></script>
<link rel="shortcut icon" href=/img/favicon.png type=image/png>
<link rel=stylesheet type=text/css href=/css/buckets.css>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet type=text/css href=/css/buckets-blog.css>
<link rel=alternate hreflang=es href=https://www.budgetwithbuckets.com/es/blog/2018/08/27/sqlite-changelog.html/>
</head>
<body>
<div class=buckets-nav>
<section>
<a class=logo href=/>
<img src=/img/logo.png>
</a>
<a href=/guide/>Guide</a>
<a class=active href=/blog/>Blog</a>
<a href=/changelog/>Changelog</a>
<a target=_blank href=https://github.com/buckets/application/issues>Issue Tracker</a>
</section>
<section>
<a class=download-button href=/download/>
<img src=/images/download.svg width=15 height=15>
Download
</a>
<a class=buy-button href=/buy/>Buy $64</a>
</section>
<a href=javascript:void(0); class=nav-toggle onclick="this.parentElement.classList.toggle('nav-open')">
<img src=/img/logo.png>
<div>Menu</div>
</a>
</div>
<div class=wrapper>
<div class=post>
<header class=post-header>
<div class=next-prev-links>
<a class=prev href=/blog/2018/08/06/net-wealth.html/>&larr; Prev</a>
<a class=next href=/blog/2018/10/04/survey2018.html/>Next &rarr;</a>
</div>
<div class="post-tag tech">
<div class=tag-name>Tech post</div>
<div class=tag-description>This post is about the development of Buckets rather than budgeting.</div>
</div>
<h1 class=blog-title>JSON Changelog with SQLite</h1>
<div style=text-align:center;margin-top:2rem><svg viewBox="0 0 600 15" xmlns="http://www.w3.org/2000/svg" style="max-width:800px"><rect x="20%" y="7" width="60%" height="1" fill="lightgrey" rx="2"/><rect class="rotate" x="50%" y="4" width="7" height="7" fill="#fff" stroke="lightgrey" stroke-width="1" rx="1"/></svg>
</div>
<p class=post-meta>
Aug 27, 2018
• Matt
</p>
</header>
<article class=post-content>
<p>Sometimes you want a log of all changes to the data in your database (every INSERT, UPDATE and DELETE). In Buckets' case, such a log will be used to help merge budget files between computers/phones.</p>
<p>In this post, I&rsquo;ll show you one method for adding change tracking to your SQLite database. Someone has probably already done it this way, but I couldn&rsquo;t find it.</p>
<h2 id=do-you-need-it>Do you need it?<a class=anchor-link href=#do-you-need-it>&para;</a></h2>
<p>Before you start tracking every single change in your database, decide if you really need it. You might be able to get away with tracking specific columns, for instance.</p>
<div style=text-align:center;margin-top:2rem><svg viewBox="0 0 600 15" xmlns="http://www.w3.org/2000/svg" style="max-width:800px"><rect x="20%" y="7" width="60%" height="1" fill="lightgrey" rx="2"/><rect class="rotate" x="50%" y="4" width="7" height="7" fill="#fff" stroke="lightgrey" stroke-width="1" rx="1"/></svg>
</div>
<h2 id=the-data>The Data<a class=anchor-link href=#the-data>&para;</a></h2>
<p>I have a <code>people</code> table created with the following SQL:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> people (
    id INTEGER <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
    created <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span>,
    name TEXT,
    age INTEGER
);
</code></pre></div><h2 id=sqlite--json>SQLite + JSON<a class=anchor-link href=#sqlite--json>&para;</a></h2>
<p>SQLite includes some <a href=https://www.sqlite.org/json1.html>nice JSON functions</a>. Before showing you how to use them to make a change log, here&rsquo;s how some of the functions work on their own:</p>
<h3 id=json_array>json_array<a class=anchor-link href=#json_array>&para;</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>sqlite<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>select</span> json_array(<span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;hello&#34;</span>, <span style=color:#e6db74>&#34;world&#34;</span>) <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>data</span>;
<span style=color:#66d9ef>data</span>               
<span style=color:#75715e>-------------------
</span><span style=color:#75715e></span>[<span style=color:#ae81ff>1</span>,<span style=color:#e6db74>&#34;hello&#34;</span>,<span style=color:#e6db74>&#34;world&#34;</span>]   
</code></pre></div><h3 id=json_extract>json_extract<a class=anchor-link href=#json_extract>&para;</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>sqlite<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>select</span> json_extract(<span style=color:#e6db74>&#39;{&#34;foo&#34;: &#34;bar&#34;}&#39;</span>, <span style=color:#e6db74>&#39;$.foo&#39;</span>) <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>data</span>;
<span style=color:#66d9ef>data</span>      
<span style=color:#75715e>----------
</span><span style=color:#75715e></span>bar      
</code></pre></div><h3 id=json_group_object>json_group_object<a class=anchor-link href=#json_group_object>&para;</a></h3>
<p>This is an aggregate function.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>sqlite<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>create</span> <span style=color:#66d9ef>temporary</span> <span style=color:#66d9ef>table</span> foo (a, b);
sqlite<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> foo (a, b) <span style=color:#66d9ef>values</span> (<span style=color:#e6db74>&#34;Alice&#34;</span>, <span style=color:#ae81ff>30</span>), (<span style=color:#e6db74>&#34;Bob&#34;</span>, <span style=color:#ae81ff>42</span>);
sqlite<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>select</span> json_group_object(a, b) <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>data</span> <span style=color:#66d9ef>from</span> foo;
<span style=color:#66d9ef>data</span>
<span style=color:#75715e>-----------------------
</span><span style=color:#75715e></span><span style=color:#960050;background-color:#1e0010>{</span><span style=color:#e6db74>&#34;Alice&#34;</span>:<span style=color:#ae81ff>30</span>,<span style=color:#e6db74>&#34;Bob&#34;</span>:<span style=color:#ae81ff>42</span><span style=color:#960050;background-color:#1e0010>}</span>
</code></pre></div><h3 id=json_each>json_each<a class=anchor-link href=#json_each>&para;</a></h3>
<p>This is a table-value function (it produces a table).</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>sqlite<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> json_each(json_array(<span style=color:#e6db74>&#34;apple&#34;</span>,<span style=color:#e6db74>&#34;banana&#34;</span>,<span style=color:#e6db74>&#34;cow&#34;</span>));
<span style=color:#66d9ef>key</span>         value       <span style=color:#66d9ef>type</span>        atom        id          parent      fullkey     path      
<span style=color:#75715e>----------  ----------  ----------  ----------  ----------  ----------  ----------  ----------
</span><span style=color:#75715e></span><span style=color:#ae81ff>0</span>           apple       text        apple       <span style=color:#ae81ff>1</span>                       <span style=color:#960050;background-color:#1e0010>$</span>[<span style=color:#ae81ff>0</span>]        <span style=color:#960050;background-color:#1e0010>$</span>         
<span style=color:#ae81ff>1</span>           banana      text        banana      <span style=color:#ae81ff>2</span>                       <span style=color:#960050;background-color:#1e0010>$</span>[<span style=color:#ae81ff>1</span>]        <span style=color:#960050;background-color:#1e0010>$</span>         
<span style=color:#ae81ff>2</span>           cow         text        cow         <span style=color:#ae81ff>3</span>                       <span style=color:#960050;background-color:#1e0010>$</span>[<span style=color:#ae81ff>2</span>]        <span style=color:#960050;background-color:#1e0010>$</span>         
</code></pre></div><h2 id=json-change-logs>JSON Change Logs<a class=anchor-link href=#json-change-logs>&para;</a></h2>
<p>Using the above functions, you can make change logs!</p>
<h3 id=version-1---track-everything>Version 1 - Track Everything<a class=anchor-link href=#version-1---track-everything>&para;</a></h3>
<p>The following change log table tracks all changes to all columns:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#75715e>-- Data table
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> people (
    id INTEGER <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
    created <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span>,
    name TEXT,
    age INTEGER
);

<span style=color:#75715e>-- Change log table
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> change_log (
    id INTEGER <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
    created <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span>,
    action TEXT,
    <span style=color:#66d9ef>table_name</span> TEXT,
    obj_id INTEGER,
    changes TEXT
);

<span style=color:#75715e>-- Insert Trigger
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> people_track_insert
<span style=color:#66d9ef>AFTER</span> <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>ON</span> people
<span style=color:#66d9ef>BEGIN</span>
  <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> change_log (action, <span style=color:#66d9ef>table_name</span>, obj_id, changes)
  <span style=color:#66d9ef>SELECT</span>
    <span style=color:#e6db74>&#39;INSERT&#39;</span>, <span style=color:#e6db74>&#39;people&#39;</span>, <span style=color:#66d9ef>NEW</span>.id, changes
  <span style=color:#66d9ef>FROM</span>
    (<span style=color:#66d9ef>SELECT</span>
      json_group_object(col, json_array(oldval, newval)) <span style=color:#66d9ef>AS</span> changes
    <span style=color:#66d9ef>FROM</span>
      (<span style=color:#66d9ef>SELECT</span>
        json_extract(value, <span style=color:#e6db74>&#39;$[0]&#39;</span>) <span style=color:#66d9ef>as</span> col,
        json_extract(value, <span style=color:#e6db74>&#39;$[1]&#39;</span>) <span style=color:#66d9ef>as</span> oldval,
        json_extract(value, <span style=color:#e6db74>&#39;$[2]&#39;</span>) <span style=color:#66d9ef>as</span> newval
      <span style=color:#66d9ef>FROM</span>
        json_each(
          json_array(
            json_array(<span style=color:#e6db74>&#39;id&#39;</span>, <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>NEW</span>.id),
            json_array(<span style=color:#e6db74>&#39;created&#39;</span>, <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>NEW</span>.created),
            json_array(<span style=color:#e6db74>&#39;name&#39;</span>, <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>NEW</span>.name),
            json_array(<span style=color:#e6db74>&#39;age&#39;</span>, <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>NEW</span>.age)
          )
        )
      )
    );
<span style=color:#66d9ef>END</span>;

<span style=color:#75715e>-- Update Trigger
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> people_track_update
<span style=color:#66d9ef>AFTER</span> <span style=color:#66d9ef>UPDATE</span> <span style=color:#66d9ef>ON</span> people
<span style=color:#66d9ef>BEGIN</span>
  <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> change_log (action, <span style=color:#66d9ef>table_name</span>, obj_id, changes)
  <span style=color:#66d9ef>SELECT</span>
    <span style=color:#e6db74>&#39;UPDATE&#39;</span>, <span style=color:#e6db74>&#39;people&#39;</span>, <span style=color:#66d9ef>OLD</span>.id, changes
  <span style=color:#66d9ef>FROM</span>
    (<span style=color:#66d9ef>SELECT</span>
      json_group_object(col, json_array(oldval, newval)) <span style=color:#66d9ef>AS</span> changes
    <span style=color:#66d9ef>FROM</span>
      (<span style=color:#66d9ef>SELECT</span>
        json_extract(value, <span style=color:#e6db74>&#39;$[0]&#39;</span>) <span style=color:#66d9ef>as</span> col,
        json_extract(value, <span style=color:#e6db74>&#39;$[1]&#39;</span>) <span style=color:#66d9ef>as</span> oldval,
        json_extract(value, <span style=color:#e6db74>&#39;$[2]&#39;</span>) <span style=color:#66d9ef>as</span> newval
      <span style=color:#66d9ef>FROM</span>
        json_each(
          json_array(
            json_array(<span style=color:#e6db74>&#39;id&#39;</span>, <span style=color:#66d9ef>OLD</span>.id, <span style=color:#66d9ef>NEW</span>.id),
            json_array(<span style=color:#e6db74>&#39;created&#39;</span>, <span style=color:#66d9ef>OLD</span>.created, <span style=color:#66d9ef>NEW</span>.created),
            json_array(<span style=color:#e6db74>&#39;name&#39;</span>, <span style=color:#66d9ef>OLD</span>.name, <span style=color:#66d9ef>NEW</span>.name),
            json_array(<span style=color:#e6db74>&#39;age&#39;</span>, <span style=color:#66d9ef>OLD</span>.age, <span style=color:#66d9ef>NEW</span>.age)
          )
        )
      )
    );
<span style=color:#66d9ef>END</span>;

<span style=color:#75715e>-- Delete Trigger
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> people_track_delete
<span style=color:#66d9ef>AFTER</span> <span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>ON</span> people
<span style=color:#66d9ef>BEGIN</span>
  <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> change_log (action, <span style=color:#66d9ef>table_name</span>, obj_id, changes)
  <span style=color:#66d9ef>SELECT</span>
    <span style=color:#e6db74>&#39;DELETE&#39;</span>, <span style=color:#e6db74>&#39;people&#39;</span>, <span style=color:#66d9ef>OLD</span>.id, changes
  <span style=color:#66d9ef>FROM</span>
    (<span style=color:#66d9ef>SELECT</span>
      json_group_object(col, json_array(oldval, newval)) <span style=color:#66d9ef>AS</span> changes
    <span style=color:#66d9ef>FROM</span>
      (<span style=color:#66d9ef>SELECT</span>
        json_extract(value, <span style=color:#e6db74>&#39;$[0]&#39;</span>) <span style=color:#66d9ef>as</span> col,
        json_extract(value, <span style=color:#e6db74>&#39;$[1]&#39;</span>) <span style=color:#66d9ef>as</span> oldval,
        json_extract(value, <span style=color:#e6db74>&#39;$[2]&#39;</span>) <span style=color:#66d9ef>as</span> newval
      <span style=color:#66d9ef>FROM</span>
        json_each(
          json_array(
            json_array(<span style=color:#e6db74>&#39;id&#39;</span>, <span style=color:#66d9ef>OLD</span>.id, <span style=color:#66d9ef>null</span>),
            json_array(<span style=color:#e6db74>&#39;created&#39;</span>, <span style=color:#66d9ef>OLD</span>.created, <span style=color:#66d9ef>null</span>),
            json_array(<span style=color:#e6db74>&#39;name&#39;</span>, <span style=color:#66d9ef>OLD</span>.name, <span style=color:#66d9ef>null</span>),
            json_array(<span style=color:#e6db74>&#39;age&#39;</span>, <span style=color:#66d9ef>OLD</span>.age, <span style=color:#66d9ef>null</span>)
          )
        )
      )
    );
<span style=color:#66d9ef>END</span>;
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>sqlite&gt; INSERT INTO people (name, age) VALUES (&#39;Alice&#39;, 30), (&#39;Bob&#39;, 42);
sqlite&gt; UPDATE people SET age = age + 2;
sqlite&gt; UPDATE people SET name = &#39;Eva&#39; WHERE name=&#39;Alice&#39;;
sqlite&gt; DELETE FROM people WHERE name = &#39;Bob&#39;;
sqlite&gt; SELECT * FROM change_log;
id   created     action      table_name  obj_id  changes                                                                         
---  ----------  ----------  ----------  ------  --------------------------------------------------------------------------------
1    2018-08-27  INSERT      people      1       {&#34;id&#34;:[null,1],&#34;created&#34;:[null,&#34;2018-08-27 21:53:02&#34;],&#34;name&#34;:[null,&#34;Alice&#34;],&#34;age
2    2018-08-27  INSERT      people      2       {&#34;id&#34;:[null,2],&#34;created&#34;:[null,&#34;2018-08-27 21:53:02&#34;],&#34;name&#34;:[null,&#34;Bob&#34;],&#34;age&#34;:
3    2018-08-27  UPDATE      people      1       {&#34;id&#34;:[1,1],&#34;created&#34;:[&#34;2018-08-27 21:53:02&#34;,&#34;2018-08-27 21:53:02&#34;],&#34;name&#34;:[&#34;Ali
4    2018-08-27  UPDATE      people      2       {&#34;id&#34;:[2,2],&#34;created&#34;:[&#34;2018-08-27 21:53:02&#34;,&#34;2018-08-27 21:53:02&#34;],&#34;name&#34;:[&#34;Bob
5    2018-08-27  UPDATE      people      1       {&#34;id&#34;:[1,1],&#34;created&#34;:[&#34;2018-08-27 21:53:02&#34;,&#34;2018-08-27 21:53:02&#34;],&#34;name&#34;:[&#34;Ali
6    2018-08-27  DELETE      people      2       {&#34;id&#34;:[2,null],&#34;created&#34;:[&#34;2018-08-27 21:53:02&#34;,null],&#34;name&#34;:[&#34;Bob&#34;,null],&#34;age&#34;:
</code></pre></div><h3 id=version-2---only-track-changes>Version 2 - Only Track Changes<a class=anchor-link href=#version-2---only-track-changes>&para;</a></h3>
<p>There&rsquo;s a lot of duplicate information in the above version (for instance, the created timestamp never changes after INSERT but is recorded twice for every UPDATE). This version improves on the other by only recording values that have changed.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#75715e>-- Data table
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> people (
    id INTEGER <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
    created <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span>,
    name TEXT,
    age INTEGER
);

<span style=color:#75715e>-- Change log table
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> change_log (
    id INTEGER <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
    created <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span>,
    action TEXT,
    <span style=color:#66d9ef>table_name</span> TEXT,
    obj_id INTEGER,
    changes TEXT
);

<span style=color:#75715e>-- Insert Trigger
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> people_track_insert
<span style=color:#66d9ef>AFTER</span> <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>ON</span> people
<span style=color:#66d9ef>BEGIN</span>
  <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> change_log (action, <span style=color:#66d9ef>table_name</span>, obj_id, changes)
  <span style=color:#66d9ef>SELECT</span>
    <span style=color:#e6db74>&#39;INSERT&#39;</span>, <span style=color:#e6db74>&#39;people&#39;</span>, <span style=color:#66d9ef>NEW</span>.id, changes
  <span style=color:#66d9ef>FROM</span>
    (<span style=color:#66d9ef>SELECT</span>
      json_group_object(col, json_array(oldval, newval)) <span style=color:#66d9ef>AS</span> changes
    <span style=color:#66d9ef>FROM</span>
      (<span style=color:#66d9ef>SELECT</span>
        json_extract(value, <span style=color:#e6db74>&#39;$[0]&#39;</span>) <span style=color:#66d9ef>as</span> col,
        json_extract(value, <span style=color:#e6db74>&#39;$[1]&#39;</span>) <span style=color:#66d9ef>as</span> oldval,
        json_extract(value, <span style=color:#e6db74>&#39;$[2]&#39;</span>) <span style=color:#66d9ef>as</span> newval
      <span style=color:#66d9ef>FROM</span>
        json_each(
          json_array(
            json_array(<span style=color:#e6db74>&#39;id&#39;</span>, <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>NEW</span>.id),
            json_array(<span style=color:#e6db74>&#39;created&#39;</span>, <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>NEW</span>.created),
            json_array(<span style=color:#e6db74>&#39;name&#39;</span>, <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>NEW</span>.name),
            json_array(<span style=color:#e6db74>&#39;age&#39;</span>, <span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>NEW</span>.age)
          )
        )
      <span style=color:#66d9ef>WHERE</span> oldval <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NOT</span> newval
      )
    );
<span style=color:#66d9ef>END</span>;

<span style=color:#75715e>-- Update Trigger
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> people_track_update
<span style=color:#66d9ef>AFTER</span> <span style=color:#66d9ef>UPDATE</span> <span style=color:#66d9ef>ON</span> people
<span style=color:#66d9ef>BEGIN</span>
  <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> change_log (action, <span style=color:#66d9ef>table_name</span>, obj_id, changes)
  <span style=color:#66d9ef>SELECT</span>
    <span style=color:#e6db74>&#39;UPDATE&#39;</span>, <span style=color:#e6db74>&#39;people&#39;</span>, <span style=color:#66d9ef>OLD</span>.id, changes
  <span style=color:#66d9ef>FROM</span>
    (<span style=color:#66d9ef>SELECT</span>
      json_group_object(col, json_array(oldval, newval)) <span style=color:#66d9ef>AS</span> changes
    <span style=color:#66d9ef>FROM</span>
      (<span style=color:#66d9ef>SELECT</span>
        json_extract(value, <span style=color:#e6db74>&#39;$[0]&#39;</span>) <span style=color:#66d9ef>as</span> col,
        json_extract(value, <span style=color:#e6db74>&#39;$[1]&#39;</span>) <span style=color:#66d9ef>as</span> oldval,
        json_extract(value, <span style=color:#e6db74>&#39;$[2]&#39;</span>) <span style=color:#66d9ef>as</span> newval
      <span style=color:#66d9ef>FROM</span>
        json_each(
          json_array(
            json_array(<span style=color:#e6db74>&#39;id&#39;</span>, <span style=color:#66d9ef>OLD</span>.id, <span style=color:#66d9ef>NEW</span>.id),
            json_array(<span style=color:#e6db74>&#39;created&#39;</span>, <span style=color:#66d9ef>OLD</span>.created, <span style=color:#66d9ef>NEW</span>.created),
            json_array(<span style=color:#e6db74>&#39;name&#39;</span>, <span style=color:#66d9ef>OLD</span>.name, <span style=color:#66d9ef>NEW</span>.name),
            json_array(<span style=color:#e6db74>&#39;age&#39;</span>, <span style=color:#66d9ef>OLD</span>.age, <span style=color:#66d9ef>NEW</span>.age)
          )
        )
      <span style=color:#66d9ef>WHERE</span> oldval <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NOT</span> newval
      )
    );
<span style=color:#66d9ef>END</span>;

<span style=color:#75715e>-- Delete Trigger
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> people_track_delete
<span style=color:#66d9ef>AFTER</span> <span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>ON</span> people
<span style=color:#66d9ef>BEGIN</span>
  <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> change_log (action, <span style=color:#66d9ef>table_name</span>, obj_id, changes)
  <span style=color:#66d9ef>SELECT</span>
    <span style=color:#e6db74>&#39;DELETE&#39;</span>, <span style=color:#e6db74>&#39;people&#39;</span>, <span style=color:#66d9ef>OLD</span>.id, changes
  <span style=color:#66d9ef>FROM</span>
    (<span style=color:#66d9ef>SELECT</span>
      json_group_object(col, json_array(oldval, newval)) <span style=color:#66d9ef>AS</span> changes
    <span style=color:#66d9ef>FROM</span>
      (<span style=color:#66d9ef>SELECT</span>
        json_extract(value, <span style=color:#e6db74>&#39;$[0]&#39;</span>) <span style=color:#66d9ef>as</span> col,
        json_extract(value, <span style=color:#e6db74>&#39;$[1]&#39;</span>) <span style=color:#66d9ef>as</span> oldval,
        json_extract(value, <span style=color:#e6db74>&#39;$[2]&#39;</span>) <span style=color:#66d9ef>as</span> newval
      <span style=color:#66d9ef>FROM</span>
        json_each(
          json_array(
            json_array(<span style=color:#e6db74>&#39;id&#39;</span>, <span style=color:#66d9ef>OLD</span>.id, <span style=color:#66d9ef>null</span>),
            json_array(<span style=color:#e6db74>&#39;created&#39;</span>, <span style=color:#66d9ef>OLD</span>.created, <span style=color:#66d9ef>null</span>),
            json_array(<span style=color:#e6db74>&#39;name&#39;</span>, <span style=color:#66d9ef>OLD</span>.name, <span style=color:#66d9ef>null</span>),
            json_array(<span style=color:#e6db74>&#39;age&#39;</span>, <span style=color:#66d9ef>OLD</span>.age, <span style=color:#66d9ef>null</span>)
          )
        )
      <span style=color:#66d9ef>WHERE</span> oldval <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NOT</span> newval
      )
    );
<span style=color:#66d9ef>END</span>;
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>sqlite&gt; INSERT INTO people (name, age) VALUES (&#39;Alice&#39;, 30), (&#39;Bob&#39;, 42);
sqlite&gt; UPDATE people SET age = age + 2;
sqlite&gt; UPDATE people SET name = &#39;Eva&#39; WHERE name=&#39;Alice&#39;;
sqlite&gt; DELETE FROM people WHERE name = &#39;Bob&#39;;
sqlite&gt; SELECT * FROM change_log;
id   created     action      table_name  obj_id  changes                                                                         
---  ----------  ----------  ----------  ------  --------------------------------------------------------------------------------
1    2018-08-27  INSERT      people      1       {&#34;id&#34;:[null,1],&#34;created&#34;:[null,&#34;2018-08-27 21:53:25&#34;],&#34;name&#34;:[null,&#34;Alice&#34;],&#34;age
2    2018-08-27  INSERT      people      2       {&#34;id&#34;:[null,2],&#34;created&#34;:[null,&#34;2018-08-27 21:53:25&#34;],&#34;name&#34;:[null,&#34;Bob&#34;],&#34;age&#34;:
3    2018-08-27  UPDATE      people      1       {&#34;age&#34;:[30,32]}                                                                 
4    2018-08-27  UPDATE      people      2       {&#34;age&#34;:[42,44]}                                                                 
5    2018-08-27  UPDATE      people      1       {&#34;name&#34;:[&#34;Alice&#34;,&#34;Eva&#34;]}                                                        
6    2018-08-27  DELETE      people      2       {&#34;id&#34;:[2,null],&#34;created&#34;:[&#34;2018-08-27 21:53:25&#34;,null],&#34;name&#34;:[&#34;Bob&#34;,null],&#34;age&#34;:
</code></pre></div><h3 id=version-3---only-old-values>Version 3 - Only Old Values<a class=anchor-link href=#version-3---only-old-values>&para;</a></h3>
<p>In Buckets, most records are inserted and never updated, and very few are deleted. So to save on space, there&rsquo;s another optimization that favors this use case. Instead of storing both old and new values, only storing old values means that:</p>
<ul>
<li>no information is duplicated for INSERTS</li>
<li>each change entry is smaller, too.</li>
</ul>
<p>More application work is required to piece together a full change log but all the information is still available.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#75715e>-- Data table
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> people (
    id INTEGER <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
    created <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span>,
    name TEXT,
    age INTEGER
);

<span style=color:#75715e>-- Change log table
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> change_log (
    id INTEGER <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
    created <span style=color:#66d9ef>TIMESTAMP</span> <span style=color:#66d9ef>DEFAULT</span> <span style=color:#66d9ef>CURRENT_TIMESTAMP</span>,
    action TEXT,
    <span style=color:#66d9ef>table_name</span> TEXT,
    obj_id INTEGER,
    oldvals TEXT
);

<span style=color:#75715e>-- Insert Trigger
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> people_track_insert
<span style=color:#66d9ef>AFTER</span> <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>ON</span> people
<span style=color:#66d9ef>BEGIN</span>
  <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> change_log (action, <span style=color:#66d9ef>table_name</span>, obj_id)
  <span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;INSERT&#39;</span>, <span style=color:#e6db74>&#39;people&#39;</span>, <span style=color:#66d9ef>NEW</span>.id);
<span style=color:#66d9ef>END</span>;

<span style=color:#75715e>-- Update Trigger
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> people_track_update
<span style=color:#66d9ef>AFTER</span> <span style=color:#66d9ef>UPDATE</span> <span style=color:#66d9ef>ON</span> people
<span style=color:#66d9ef>BEGIN</span>
  <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> change_log (action, <span style=color:#66d9ef>table_name</span>, obj_id, oldvals)
  <span style=color:#66d9ef>SELECT</span>
    <span style=color:#e6db74>&#39;UPDATE&#39;</span>, <span style=color:#e6db74>&#39;people&#39;</span>, <span style=color:#66d9ef>OLD</span>.id, changes
  <span style=color:#66d9ef>FROM</span>
    (<span style=color:#66d9ef>SELECT</span>
      json_group_object(col, oldval) <span style=color:#66d9ef>AS</span> changes
    <span style=color:#66d9ef>FROM</span>
      (<span style=color:#66d9ef>SELECT</span>
        json_extract(value, <span style=color:#e6db74>&#39;$[0]&#39;</span>) <span style=color:#66d9ef>as</span> col,
        json_extract(value, <span style=color:#e6db74>&#39;$[1]&#39;</span>) <span style=color:#66d9ef>as</span> oldval,
        json_extract(value, <span style=color:#e6db74>&#39;$[2]&#39;</span>) <span style=color:#66d9ef>as</span> newval
      <span style=color:#66d9ef>FROM</span>
        json_each(
          json_array(
            json_array(<span style=color:#e6db74>&#39;id&#39;</span>, <span style=color:#66d9ef>OLD</span>.id, <span style=color:#66d9ef>NEW</span>.id),
            json_array(<span style=color:#e6db74>&#39;created&#39;</span>, <span style=color:#66d9ef>OLD</span>.created, <span style=color:#66d9ef>NEW</span>.created),
            json_array(<span style=color:#e6db74>&#39;name&#39;</span>, <span style=color:#66d9ef>OLD</span>.name, <span style=color:#66d9ef>NEW</span>.name),
            json_array(<span style=color:#e6db74>&#39;age&#39;</span>, <span style=color:#66d9ef>OLD</span>.age, <span style=color:#66d9ef>NEW</span>.age)
          )
        )
      <span style=color:#66d9ef>WHERE</span> oldval <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NOT</span> newval
      )
    );
<span style=color:#66d9ef>END</span>;

<span style=color:#75715e>-- Delete Trigger
</span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TRIGGER</span> people_track_delete
<span style=color:#66d9ef>AFTER</span> <span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>ON</span> people
<span style=color:#66d9ef>BEGIN</span>
  <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> change_log (action, <span style=color:#66d9ef>table_name</span>, obj_id, oldvals)
  <span style=color:#66d9ef>SELECT</span>
    <span style=color:#e6db74>&#39;DELETE&#39;</span>, <span style=color:#e6db74>&#39;people&#39;</span>, <span style=color:#66d9ef>OLD</span>.id, changes
  <span style=color:#66d9ef>FROM</span>
    (<span style=color:#66d9ef>SELECT</span>
      json_group_object(col, oldval) <span style=color:#66d9ef>AS</span> changes
    <span style=color:#66d9ef>FROM</span>
      (<span style=color:#66d9ef>SELECT</span>
        json_extract(value, <span style=color:#e6db74>&#39;$[0]&#39;</span>) <span style=color:#66d9ef>as</span> col,
        json_extract(value, <span style=color:#e6db74>&#39;$[1]&#39;</span>) <span style=color:#66d9ef>as</span> oldval,
        json_extract(value, <span style=color:#e6db74>&#39;$[2]&#39;</span>) <span style=color:#66d9ef>as</span> newval
      <span style=color:#66d9ef>FROM</span>
        json_each(
          json_array(
            json_array(<span style=color:#e6db74>&#39;id&#39;</span>, <span style=color:#66d9ef>OLD</span>.id, <span style=color:#66d9ef>null</span>),
            json_array(<span style=color:#e6db74>&#39;created&#39;</span>, <span style=color:#66d9ef>OLD</span>.created, <span style=color:#66d9ef>null</span>),
            json_array(<span style=color:#e6db74>&#39;name&#39;</span>, <span style=color:#66d9ef>OLD</span>.name, <span style=color:#66d9ef>null</span>),
            json_array(<span style=color:#e6db74>&#39;age&#39;</span>, <span style=color:#66d9ef>OLD</span>.age, <span style=color:#66d9ef>null</span>)
          )
        )
      <span style=color:#66d9ef>WHERE</span> oldval <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NOT</span> newval
      )
    );
<span style=color:#66d9ef>END</span>;
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>sqlite&gt; INSERT INTO people (name, age) VALUES (&#39;Alice&#39;, 30), (&#39;Bob&#39;, 42);
sqlite&gt; UPDATE people SET age = age + 2;
sqlite&gt; UPDATE people SET name = &#39;Eva&#39; WHERE name=&#39;Alice&#39;;
sqlite&gt; DELETE FROM people WHERE name = &#39;Bob&#39;;
sqlite&gt; SELECT * FROM change_log;
id   created     action      table_name  obj_id  oldvals                                                                         
---  ----------  ----------  ----------  ------  --------------------------------------------------------------------------------
1    2018-08-27  INSERT      people      1                                                                                       
2    2018-08-27  INSERT      people      2                                                                                       
3    2018-08-27  UPDATE      people      1       {&#34;age&#34;:30}                                                                      
4    2018-08-27  UPDATE      people      2       {&#34;age&#34;:42}                                                                      
5    2018-08-27  UPDATE      people      1       {&#34;name&#34;:&#34;Alice&#34;}                                                                
6    2018-08-27  DELETE      people      2       {&#34;id&#34;:2,&#34;created&#34;:&#34;2018-08-27 21:53:53&#34;,&#34;name&#34;:&#34;Bob&#34;,&#34;age&#34;:44}                  
</code></pre></div><p>You can also query the changelog using JSON functions. Here&rsquo;s every change involving the <code>age</code> field:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>sqlite&gt; SELECT * FROM change_log WHERE json_type(oldvals, &#39;$.age&#39;) IS NOT NULL;
id   created     action      table_name  obj_id  oldvals                                                                         
---  ----------  ----------  ----------  ------  --------------------------------------------------------------------------------
3    2018-08-27  UPDATE      people      1       {&#34;age&#34;:30}                                                                      
4    2018-08-27  UPDATE      people      2       {&#34;age&#34;:42}                                                                      
6    2018-08-27  DELETE      people      2       {&#34;id&#34;:2,&#34;created&#34;:&#34;2018-08-27 22:02:23&#34;,&#34;name&#34;:&#34;Bob&#34;,&#34;age&#34;:44}                  
</code></pre></div><h2 id=using-sqlite_master-and-table_info>Using sqlite_master and table_info<a class=anchor-link href=#using-sqlite_master-and-table_info>&para;</a></h2>
<p>To make sure I never miss a column, I use <code>sqlite_master</code> and <code>PRAGMA table_info(TABLENAME)</code> to generate the trigger SQL as in this pseudo code:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>rows <span style=color:#f92672>=</span> Query(<span style=color:#e6db74>&#34;SELECT name FROM sqlite_master WHERE type=&#39;table&#39;&#34;</span>)
<span style=color:#66d9ef>for</span> row <span style=color:#f92672>in</span> rows:
  columns <span style=color:#f92672>=</span> Query(<span style=color:#e6db74>&#34;PRAGMA table_info(&#34;</span> <span style=color:#f92672>+</span> row<span style=color:#f92672>.</span>name <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;)&#34;</span>)
  <span style=color:#75715e># generate SQL using this table and column list</span>
</code></pre></div><p>— Matt</p>
</article>
<div style=text-align:center;margin-top:2rem><svg viewBox="0 0 600 15" xmlns="http://www.w3.org/2000/svg" style="max-width:800px"><rect x="20%" y="7" width="60%" height="1" fill="lightgrey" rx="2"/><rect class="rotate" x="50%" y="4" width="7" height="7" fill="#fff" stroke="lightgrey" stroke-width="1" rx="1"/></svg>
</div>
<div class="next-prev-links close" style=margin-top:1rem>
<a class=prev href=/blog/2018/08/06/net-wealth.html/>&larr; Prev</a>
<a class=next href=/blog/2018/10/04/survey2018.html/>Next &rarr;</a>
</div>
<h2 style=margin-top:2rem>Comments</h2>
<div class=comment>
<img src="https://www.gravatar.com/avatar/cff2c2b07e40286267fd634ca8bf661e?s=64">
<div>
<div class=details>
<div class=author>Thales</div>
<div class=date>Tue Aug 28, 2018 7:33</div>
</div>
<div class=message>This is a very nice solution. I remember the first time I had to track changes like this.
Do you know if one can bind values into the Json function parameters when using prepared queries?</div>
</div>
</div>
<div class=comment>
<img src="https://www.gravatar.com/avatar/4169b4fbaba6240938d2d4817e4d7cf2?s=64">
<div>
<div class=details>
<div class=author>Alec Jacobs</div>
<div class=date>Wed Aug 29, 2018 3:19</div>
</div>
<div class=message>Have you seen Rqlite? (https://github.com/rqlite/rqlite)</div>
</div>
</div>
<div class=comment>
<img src="https://www.gravatar.com/avatar/3a760317157c33e6b977df8e35ae857d?s=64">
<div>
<div class=details>
<div class=author>Matt</div>
<div class=date>Wed Aug 29, 2018 3:21</div>
</div>
<div class=message>Thales,
Yes, you can bind values into the JSON function. For instance (this is python):
>>> import sqlite3
>>> db = sqlite3.connect(':memory:')
>>> db.execute('SELECT json_array(?, ?, ?)', ('foo', 123, True)).fetchone()
(u'["foo",123,1]',)
Alec,
Very cool! I had not seen that before.</div>
</div>
</div>
<div class=comment>
<img src="https://www.gravatar.com/avatar/?s=64">
<div>
<div class=details>
<div class=author>DD</div>
<div class=date>Sat Nov 3, 2018 8:59</div>
</div>
<div class=message>I'm curious, have you evaluated the performance cost of doing this?
I'm guessing it might not matter in your case. FWIW, I find your technique
really interesting and creative, thanks for sharing (discovered it via a question
on SQLite's ML BTW), but I'm curious (worried?) about its potential slowdown.</div>
</div>
</div>
<div class=comment>
<img src="https://www.gravatar.com/avatar/3a760317157c33e6b977df8e35ae857d?s=64">
<div>
<div class=details>
<div class=author>Matt</div>
<div class=date>Mon Nov 5, 2018 4:24</div>
</div>
<div class=message>DD,
I haven't evaluated performance much (because Buckets is much more read-intensive than write intensive). But I threw a play benchmark together that shows there is *some* overhead:
https://gist.github.com/iffy/c8ca8a852c0bd4e35dc027f7cb39f762</div>
</div>
</div>
<div class=comment>
<img src="https://www.gravatar.com/avatar/?s=64">
<div>
<div class=details>
<div class=author>Oivind</div>
<div class=date>Thu Apr 16, 2020 2:38</div>
</div>
<div class=message>Hi,
Thank you so much for a great post!
I was wondering, is there a way to monitor all columns in a table without declaring each and everyone in the json_array? Reason I am asking is that I would like to implement your solution on tables with more than 100 columns.
All the best. </div>
</div>
</div>
<div class=comment>
<img src="https://www.gravatar.com/avatar/3a760317157c33e6b977df8e35ae857d?s=64">
<div>
<div class=details>
<div class=author>Matt</div>
<div class=date>Thu Apr 16, 2020 4:11</div>
</div>
<div class=message>Hi Oivind,
I haven't found a way to track all columns using only SQL. This is because I can't figure out a way to do the equivalent of something like OLD[somecolumn] to choose the field from OLD whose key is the value of somecolumn. SQLite doesn't seem to provide that level of reflection.
Instead (as noted in the last section) I punt to the language I'm using SQLite from to construct the triggers. Hope that helps!</div>
</div>
</div>
<div id=comment-form style=display:none>
<a name=comment-form></a>
<script>window.location.search.substr(1).indexOf('comment=submitted')!==-1&&document.write(`<div class="notification">Comment submitted!  Your comment will be posted here after being reviewed.</div>`)</script>
<script>function setCommentStatus(b,c){const a=document.getElementById('comment-notification');a.innerText=b,a.setAttribute('class',c),a.setAttribute('style','')}function submitComment(c){const b=document.getElementById('comment-submit');b.disabled=!0,setCommentStatus('Submitting...','notification'),c.preventDefault();const d=document.getElementById('comment-message').value,e=document.getElementById('comment-email').value,f=document.getElementById('comment-name').value,g=document.getElementById('comment-slug').value,h={comment:d,email:e,name:f,subdir:g};let a=new XMLHttpRequest;a.addEventListener('load',a=>{setCommentStatus('Comment submitted!  Your comment will be posted here after being reviewed.','notification'),b.disabled=!1}),a.addEventListener('error',a=>{console.log('Error',a),setCommentStatus('Error submitting comment.  If it continues not to work, please email us.','notification error'),b.disabled=!1}),a.open('POST','https://7nd5a97217.execute-api.us-east-1.amazonaws.com/default/GitHubJekyllComments'),a.send(JSON.stringify(h))}XMLHttpRequest&&document.getElementById('comment-form').setAttribute('style','')</script>
<form method=post class=comment-form onsubmit="return submitComment(event),!1">
<input type=hidden id=comment-slug value=sqlite-changelog>
<label>Name:<br><input id=comment-name type=text></label>
<label>Email (optional&mdash;not displayed):<br><input id=comment-email type=email></label>
<label>Message:</label>
<textarea id=comment-message></textarea>
<button type=submit id=comment-submit>Add comment</button>
</form>
<div id=comment-notification style=display:none></div>
</div>
<div class=mailing-list-main style=margin-top:2rem>
<div class=mailing-list-title>Get these posts in your email, monthly:</div>
<p>
<link href=//cdn-images.mailchimp.com/embedcode/classic-10_7.css rel=stylesheet type=text/css>
<style type=text/css>#mc_embed_signup{background:0 0;clear:left}#mc_embed_signup form{padding:0}#mc_embed_signup input{border-radius:3px}#mc_embed_signup input[type=submit]{background-color:#08c}</style>
<div id=mc_embed_signup>
<form action="https://bucketsisbetter.us8.list-manage.com/subscribe/post?u=bc109895c8df246ae54ad4d71&id=0960a6d05e" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=validate target=_blank novalidate>
<div id=mc_embed_signup_scroll>
<div class=mc-field-group>
<label for=mce-EMAIL>Email Address
</label>
<input type=email name=EMAIL class="required email" id=mce-EMAIL>
</div>
<div class=mc-field-group>
<label for=mce-FNAME>First Name
</label>
<input type=text name=FNAME class=required id=mce-FNAME>
</div>
<div id=mce-responses class=clear>
<div class=response id=mce-error-response style=display:none></div>
<div class=response id=mce-success-response style=display:none></div>
</div>
<div style=position:absolute;left:-5000px aria-hidden=true><input type=text name=b_bc109895c8df246ae54ad4d71_0960a6d05e tabindex=-1></div>
<div class=clear><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class=button></div>
</div>
</form>
</div>
</p>
</div>
</div>
</div>
<div style=text-align:center;margin-top:2rem><svg viewBox="0 0 600 15" xmlns="http://www.w3.org/2000/svg" style="max-width:800px"><rect x="20%" y="7" width="60%" height="1" fill="lightgrey" rx="2"/><rect class="rotate" x="50%" y="4" width="7" height="7" fill="#fff" stroke="lightgrey" stroke-width="1" rx="1"/></svg>
</div>
<footer>
<div><a href=https://onepartrain.com target=_blank data-umami-event=onepartrainlink>&copy; One Part Rain, LLC</a></div>
<div><a href=mailto:hello@budgetwithbuckets.com>hello@budgetwithbuckets.com</a></div>
<div><a href=https://www.patreon.com/iffy target=_blank data-umami-event=donatelink>Donate</a></div>
<div><a href=/guide/privacypolicy>Privacy</a></div>
<div>
<details>
<summary>English</summary>
<div><a href=/es/blog/2018/08/27/sqlite-changelog.html/>español</a></div>
</details>
</div>
</footer>
<script type=text/javascript>var Tawk_API=Tawk_API||{},Tawk_LoadStart=new Date;(function(){var a=document.createElement("script"),b=document.getElementsByTagName("script")[0];a.async=!0,a.src='https://embed.tawk.to/59835f8ed1385b2b2e285765/default',a.charset='UTF-8',a.setAttribute('crossorigin','*'),b.parentNode.insertBefore(a,b)})()</script>
</body>
</html>